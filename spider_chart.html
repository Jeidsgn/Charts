<!DOCTYPE html>
<html>
<head>
  <title>Gráfica de Telaraña con D3.js</title>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <svg id="chart" width="500" height="500" style="padding: 40px;"></svg>

  <script>
    // Carga el archivo JSON
    d3.csv("data.csv).then((data) => {
      const countryCounts = {};

      data.forEach((d) => {
        const country = d.País;
        countryCounts[country] = (countryCounts[country] || 0) + 1;
      });

        // Obtener el top 10 de países más repetidos
        const topCountries = Object.keys(countryCounts).sort((a, b) => countryCounts[b] - countryCounts[a]).slice(0, 10);

        // Obtener el país con la mayor cantidad de repeticiones
        const maxCount = d3.max(topCountries.map(d => countryCounts[d]));


        // Representar la gráfica de telaraña
        const width = 500;
        const height = 500;
        const svg = d3.select("#chart");

        // Escalas
        const angleScale = d3.scaleBand().domain(topCountries).range([0, Math.PI * 2]);
        const radiusScale = d3.scaleLinear().domain([0, maxCount]).range([0, height / 3]);

        // Calcular el total de repeticiones en la gráfica
        const totalCount = topCountries.reduce((acc, country) => acc + countryCounts[country], 0);

        // Crear los ejes radiales
        const axes = svg.append("g").attr("transform", `translate(${width / 2},${height / 2})`);
        axes
          .selectAll(".axis")
          .data(topCountries)
          .enter()
          .append("line")
          .attr("class", "axis")
          .attr("x1", 0)
          .attr("y1", 0)
          .attr("x2", (d) => radiusScale(maxCount) * Math.cos(angleScale(d) - Math.PI / 2))
          .attr("y2", (d) => radiusScale(maxCount) * Math.sin(angleScale(d) - Math.PI / 2))
          .style("stroke", "black")
          .style("stroke-width", "3px")
          .style("opacity", "0.4");

        // Crear los ejes circulares (círculos tangenciales)
        const circles = svg.append("g").attr("transform", `translate(${width / 2},${height / 2})`);

        circles
          .selectAll(".circle-axis")
          .data(d3.range(1, 11)) // Crear 10 ejes circulares (del 10% al 100%)
          .enter()
          .append("circle")
          .attr("class", "circle-axis")
          .attr("cx", 0)
          .attr("cy", 0)
          .attr("r", (d) => {const circleRadius = radiusScale(totalCount) * 0.1 * d;
                            return circleRadius <= radiusScale(maxCount) ? circleRadius : 0; // Establecer el radio a 0 si es mayor al radio máximo
                            })
          .style("stroke", "black")
          .style("stroke-width", "3px")
          .style("fill", "none")
          .style("opacity", "0.4");

        // Crear el área sombreada que une los países
        const area = d3.areaRadial()
          .angle(d => angleScale(d))
          .outerRadius(d => radiusScale(countryCounts[d]));

        const path = svg.append("path")
          .datum(topCountries)
          .attr("fill", "#4B92E5")
          .attr("fill-opacity", "0.5")
          .attr("transform", `translate(${width / 2},${height / 2})`)
          .attr("d", area);

        // Crear las etiquetas con emojis
        const emojis = {
          "Argentina": "\u{1F1E6}\u{1F1F7}",
          "Colombia": "\u{1F1E8}\u{1F1F4}",
          "Perú": "\u{1F1F5}\u{1F1EA}",
          "México": "\u{1F1F2}\u{1F1FD}",
          "Chile": "\u{1F1E8}\u{1F1F1}",
          "Brasil": "\u{1F1E7}\u{1F1F7}",
          "Arabia": "\u{1F1E6}\u{1F1EA}",
          "India": "\u{1F1EE}\u{1F1F3}",
          "China": "\u{1F1E8}\u{1F1F3}",
          "España": "\u{1F1EA}\u{1F1F8}",
          "Venezuela": "\u{1F1FB}\u{1F1EA}"
          // Agregar más emojis de países aquí...
        };
        const labels = svg.append("g").attr("transform", `translate(${width / 2},${height / 2})`);
        labels
          .selectAll(".label")
          .data(topCountries)
          .enter()
          .append("text")
          .attr("class", "label")
          .attr("x", (d) => (radiusScale(maxCount) + 20) * Math.cos(angleScale(d) - Math.PI / 2))
          .attr("y", (d) => (radiusScale(maxCount) + 20) * Math.sin(angleScale(d) - Math.PI / 2))
          .text((d) => emojis[d])
          .style("font-size", "20px")
          .attr("text-anchor", "middle")
          .attr("alignment-baseline", "middle");
      })
      .catch(error => console.error('Error al cargar el archivo JSON:', error));
  </script>
</body>
</html>
