<!DOCTYPE html>
<html>
<head>
  <title>Gr치fica Apilada Horizontal con D3.js</title>
  <meta charset="utf-8">
  <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <svg id="chart" width="100%" height="80" style="padding: 10px;"></svg>

  <script>
    // Carga el archivo CSV
    d3.csv("data.csv").then((data) => {
      // Obtener los datos para la gr치fica apilada
      const ageGroups = ["-17", "18-24", "25-34", "35-44", "+44"];
      const colors = ["#FF7EA4", "#3E73B9", "#9040c8", "#4FABB2", "#FF7EA4"];
      
      const ageData = ageGroups.map((ageGroup) => {
        const filteredData = data.filter((d) => {
          const birthYear = new Date(d.Nacimiento).getFullYear();
          return (ageGroup === "-17" && birthYear > new Date().getFullYear() - 17) ||
            (ageGroup === "+44" && birthYear <= new Date().getFullYear() - 44) ||
            (ageGroup !== "-17" && ageGroup !== "+44" && 
            birthYear >= parseInt(ageGroup.split('-')[0]) &&
            birthYear <= parseInt(ageGroup.split('-')[1]));
        });

        return {
          ageGroup,
          count: filteredData.length
        };
      });

      // Calcular el total de usuarios para calcular el ancho de cada trozo
      const totalUsers = d3.sum(ageData, (d) => d.count);

      // Crear la gr치fica apilada
      const width = "100%";
      const height = 80;
      const svg = d3.select("#chart");

      const xScale = d3.scaleLinear()
        .domain([0, totalUsers])
        .range([0, width]);

      const g = svg.append("g");

      let xPosition = 0;
      ageData.forEach((d, i) => {
        const percentage = (d.count / totalUsers) * 100;
        g.append("rect")
          .attr("x", xPosition)
          .attr("y", 0)
          .attr("width", xScale(d.count))
          .attr("height", height)
          .attr("fill", colors[i]);

        g.append("text")
          .attr("x", xPosition + xScale(d.count) / 2)
          .attr("y", height / 2)
          .attr("text-anchor", "middle")
          .attr("alignment-baseline", "middle")
          .attr("fill", "white")
          .style("font-size", "12px")
          .text(`${d.count} (${percentage.toFixed(2)}%)`);

        xPosition += xScale(d.count);
      });

      // Estilos para el gr치fico
      svg.style("background-color", "#C5C4CD");
      g.style("font-family", "Montserrat, sans-serif");
    })
    .catch((error) => console.error("Error al cargar el archivo CSV:", error));
  </script>
</body>
</html>
